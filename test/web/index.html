<!DOCTYPE html>

<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <script type="text/javascript">
            function AJAX_BOOM() {
                var f = new FormData();
                f.append("4457877484", "io988ufgty67785");
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function () {
                    if (this.readyState === 4 && this.status === 200) {
                        var myObj = this.responseText;
//                            console.log(myObj);
                        var files = myObj.split(',');
                        res = document.getElementById("res")//.innerHTML = myObj;
                        for (i = 0; i < files.length - 1; i++) {
                            res.innerHTML += files[i] + ": <button class=\"download\" onclick=\"download.call(this)\" id=\"" + files[i] + "\">download</button><br>";
                        }
//                        addeve();
                    }
                };
                xmlhttp.open("POST", "http://localhost:8080/test/getfilenames.jsp", true);
                xmlhttp.send(f);
                return false;
            }
        </script>   

    </head>
    <body>
        <div id="res"></div>
        <form name="fileinfo" id="form_1" method = "post" enctype = "multipart/form-data">
            <input type = "file" name = "file" size = "50" />
            <br />
            <input type = "submit" value = "Upload File" />
        </form>
        <button onclick="AJAX_BOOM()">getCurrentFiles</button>
        <script type="text/javascript">

            var form = document.getElementById("form_1");
            form.addEventListener('submit', function (ev) {

                var oOutput = document.getElementById("res"),
                        oData = new FormData(form);

                oData.append("CustomField", "This is some extra data");

                var oReq = new XMLHttpRequest();
                oReq.open("POST", "./upload.jsp", true);
                oReq.onload = function (oEvent) {
                    if (oReq.status == 200) {
                        oOutput.innerHTML = "Uploaded!";
                    } else {
                        oOutput.innerHTML = "Error " + oReq.status + " occurred when trying to upload your file.<br \/>";
                    }
                };

                oReq.send(oData);
                ev.preventDefault();
            }, false);

        </script>
        <script type="text/javascript">
            var download = function () {
//                var ax_id = this.id.toString().trim();
                console.log(this.id.toString().trim());
                url = "http://localhost:8080/test/download.jsp?fileName=" + this.id.toString().trim();
                var z = window.open(url);
                return false;
            }
        </script>

    </body>
</html>
